# EnhancedUltra é¢„è®­ç»ƒå’Œæ¨ç†æµ‹è¯•æŒ‡å—

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### CheckpointåŠ è½½å…¼å®¹æ€§

ç°åœ¨å·²ç»ä¿®å¤äº†checkpointåŠ è½½é—®é¢˜ï¼Œæ”¯æŒï¼š
- âœ… ä»SEMMA checkpointåŠ è½½åˆ°EnhancedUltraï¼ˆéƒ¨åˆ†åŠ è½½ï¼‰
- âœ… ä»EnhancedUltra checkpointåŠ è½½åˆ°EnhancedUltraï¼ˆå®Œå…¨åŠ è½½ï¼‰
- âœ… æ–°å‚æ•°ï¼ˆç›¸ä¼¼åº¦å¢å¼ºæ¨¡å—ï¼‰ä¼šä½¿ç”¨éšæœºåˆå§‹åŒ–

## ğŸš€ æ¨èçš„ä½¿ç”¨æµç¨‹

### æ–¹æ¡ˆ1: ä»SEMMA checkpointç»§ç»­è®­ç»ƒï¼ˆæ¨èï¼‰

å¦‚æœä½ æƒ³åœ¨å·²æœ‰SEMMAæ¨¡å‹åŸºç¡€ä¸Šæ·»åŠ å¢å¼ºåŠŸèƒ½ï¼š

```bash
# 1. ä¿®æ”¹flags.yamlå¯ç”¨EnhancedUltra
sed -i 's/run: semma/run: EnhancedUltra/' flags.yaml

# 2. ä½¿ç”¨SEMMAçš„checkpointç»§ç»­è®­ç»ƒï¼ˆæ–°å‚æ•°ä¼šéšæœºåˆå§‹åŒ–ï¼‰
conda activate semma
python script/pretrain.py \
    -c config/transductive/pretrain_3g.yaml \
    --ckpt ckpts/semma.pth \
    --gpus [0]

# 3. è¯„ä¼°
python script/run.py \
    -c config/transductive/inference.yaml \
    --dataset FB15k237 \
    --epochs 0 --bpe null \
    --ckpt <æ–°è®­ç»ƒçš„checkpoint> \
    --gpus [0]
```

### æ–¹æ¡ˆ2: ä»å¤´è®­ç»ƒEnhancedUltra

å¦‚æœä½ æƒ³å®Œå…¨ç”¨EnhancedUltraè®­ç»ƒï¼š

```bash
# 1. ä¿®æ”¹flags.yamlå¯ç”¨EnhancedUltra
sed -i 's/run: semma/run: EnhancedUltra/' flags.yaml

# 2. ä»å¤´è®­ç»ƒ
conda activate semma
python script/pretrain.py \
    -c config/transductive/pretrain_3g.yaml \
    --gpus [0]

# 3. è¯„ä¼°
python script/run.py \
    -c config/transductive/inference.yaml \
    --dataset FB15k237 \
    --epochs 0 --bpe null \
    --ckpt <è®­ç»ƒçš„checkpoint> \
    --gpus [0]
```

### æ–¹æ¡ˆ3: ç›´æ¥ä½¿ç”¨SEMMA checkpointæµ‹è¯•ï¼ˆå¿«é€ŸéªŒè¯ï¼‰

å¦‚æœæƒ³å¿«é€ŸéªŒè¯å¢å¼ºåŠŸèƒ½æ˜¯å¦å·¥ä½œï¼š

```bash
# 1. ä¿®æ”¹flags.yamlå¯ç”¨EnhancedUltra
sed -i 's/run: semma/run: EnhancedUltra/' flags.yaml

# 2. ç›´æ¥ä½¿ç”¨SEMMA checkpointè¿›è¡Œæ¨ç†æµ‹è¯•
# ï¼ˆä¼šéƒ¨åˆ†åŠ è½½ï¼Œç›¸ä¼¼åº¦å¢å¼ºå‚æ•°éšæœºåˆå§‹åŒ–ï¼‰
conda activate semma
python script/run.py \
    -c config/transductive/inference.yaml \
    --dataset FB15k237 \
    --epochs 0 --bpe null \
    --ckpt ckpts/semma.pth \
    --gpus [0]
```

**æ³¨æ„**: è¿™ç§æƒ…å†µä¸‹ï¼Œç›¸ä¼¼åº¦å¢å¼ºçš„å‚æ•°æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œæ•ˆæœå¯èƒ½ä¸æ˜æ˜¾ã€‚å»ºè®®ç»§ç»­è®­ç»ƒå‡ ä¸ªepochè®©å‚æ•°å­¦ä¹ ã€‚

## ğŸ§ª éªŒè¯å¢å¼ºæ˜¯å¦å¯ç”¨

### æ–¹æ³•1: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
conda activate semma
python test_enhancement_enabled.py
```

è¿™ä¸ªè„šæœ¬ä¼šæ£€æŸ¥ï¼š
- âœ… æ¨¡å‹ç»“æ„æ˜¯å¦æ­£ç¡®
- âœ… æ¨ç†æ¨¡å¼ä¸‹æ˜¯å¦å¯ç”¨å¢å¼º
- âœ… è®­ç»ƒæ¨¡å¼ä¸‹æ˜¯å¦å¯ç”¨å¢å¼º
- âœ… å‚æ•°æ˜¯å¦å¯è®­ç»ƒ

### æ–¹æ³•2: æ£€æŸ¥æ—¥å¿—è¾“å‡º

åœ¨è®­ç»ƒ/æ¨ç†æ—¶ï¼Œè§‚å¯Ÿæ—¥å¿—ï¼š

**éƒ¨åˆ†åŠ è½½æ—¶çš„è¾“å‡º**:
```
Checkpointä¸æ¨¡å‹ä¸å®Œå…¨åŒ¹é…ï¼Œå°è¯•éƒ¨åˆ†åŠ è½½...
æ¨¡å‹ä¸­çš„ç¼ºå¤±é”®ï¼ˆå°†ä½¿ç”¨éšæœºåˆå§‹åŒ–ï¼‰: XXä¸ª
  - similarity_enhancer.similarity_threshold_raw
  - similarity_enhancer.enhancement_strength_raw
  ...
éƒ¨åˆ†åŠ è½½å®Œæˆï¼Œæ–°å‚æ•°å°†ä½¿ç”¨éšæœºåˆå§‹åŒ–
```

### æ–¹æ³•3: æ£€æŸ¥æ¨¡å‹è¡Œä¸º

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œè§‚å¯Ÿï¼š
- **æŸå¤±å˜åŒ–**: å¦‚æœæœ‰å¢å¼ºï¼ŒæŸå¤±å¯èƒ½ä¼šæœ‰å°å¹…æ³¢åŠ¨
- **è®­ç»ƒé€Ÿåº¦**: å¢å¼ºè®¡ç®—ä¼šå¢åŠ å°‘é‡æ—¶é—´ï¼ˆé€šå¸¸<5%ï¼‰
- **å†…å­˜ä½¿ç”¨**: ä¼šæœ‰å°å¹…å¢åŠ 

## ğŸ“Š è®­ç»ƒå»ºè®®

### å¦‚æœä»SEMMA checkpointç»§ç»­è®­ç»ƒ

1. **å­¦ä¹ ç‡**: å¯ä»¥ä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡ï¼ˆå¦‚åŸæ¥çš„1/10ï¼‰ä¸“é—¨è®­ç»ƒå¢å¼ºå‚æ•°
2. **è®­ç»ƒè½®æ•°**: å»ºè®®è‡³å°‘è®­ç»ƒ3-5ä¸ªepochè®©å¢å¼ºå‚æ•°å­¦ä¹ 
3. **éªŒè¯é›†**: è§‚å¯ŸéªŒè¯é›†æ€§èƒ½ï¼Œå¦‚æœæå‡å°±ç»§ç»­ï¼Œå¦‚æœä¸‹é™å¯ä»¥å‡å°å¢å¼ºå¼ºåº¦

### ä¼˜åŒ–å™¨é…ç½®å»ºè®®

å¦‚æœåªæƒ³è®­ç»ƒå¢å¼ºå‚æ•°ï¼Œå¯ä»¥ï¼š

```python
# å†»ç»“åŸæ¨¡å‹å‚æ•°ï¼Œåªè®­ç»ƒå¢å¼ºå‚æ•°
for name, param in model.named_parameters():
    if 'similarity_enhancer' not in name:
        param.requires_grad = False
```

## ğŸ” æ£€æŸ¥æ¸…å•

è®­ç»ƒå‰æ£€æŸ¥ï¼š
- [ ] flags.yamlä¸­ `run: EnhancedUltra`
- [ ] checkpointæ–‡ä»¶å­˜åœ¨ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] é…ç½®æ–‡ä»¶æ­£ç¡®

è®­ç»ƒåæ£€æŸ¥ï¼š
- [ ] checkpointä¿å­˜æˆåŠŸ
- [ ] æ—¥å¿—ä¸­æœ‰éƒ¨åˆ†åŠ è½½æç¤ºï¼ˆå¦‚æœä»SEMMAåŠ è½½ï¼‰
- [ ] è®­ç»ƒè¿‡ç¨‹æ­£å¸¸

æ¨ç†æ—¶æ£€æŸ¥ï¼š
- [ ] flags.yamlä¸­ `run: EnhancedUltra`
- [ ] checkpointåŠ è½½æˆåŠŸ
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸è¾“å‡º

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å‚æ•°åˆå§‹åŒ–**: ä»SEMMAåŠ è½½æ—¶ï¼Œç›¸ä¼¼åº¦å¢å¼ºå‚æ•°ä¼šéšæœºåˆå§‹åŒ–ï¼Œå¯èƒ½å½±å“æ€§èƒ½
2. **è®­ç»ƒæ—¶é—´**: å¢å¼ºä¼šå¢åŠ å°‘é‡è®¡ç®—ï¼Œè®­ç»ƒæ—¶é—´å¯èƒ½å¢åŠ 5-10%
3. **å†…å­˜ä½¿ç”¨**: ç›¸ä¼¼åº¦è®¡ç®—éœ€è¦é¢å¤–å†…å­˜ï¼Œæ³¨æ„GPUå†…å­˜
4. **æ•ˆæœéªŒè¯**: å»ºè®®åœ¨éªŒè¯é›†ä¸Šç›‘æ§ï¼Œç¡®ä¿å¢å¼ºæœ‰å¸®åŠ©

## ğŸ¯ æœ€ä½³å®è·µ

1. **å…ˆç”¨æ–¹æ¡ˆ3å¿«é€ŸéªŒè¯**: ç¡®ä¿ä»£ç å·¥ä½œæ­£å¸¸
2. **ç„¶åç”¨æ–¹æ¡ˆ1ç»§ç»­è®­ç»ƒ**: åœ¨SEMMAåŸºç¡€ä¸Šè®­ç»ƒå¢å¼ºå‚æ•°
3. **å¯¹æ¯”æ€§èƒ½**: ä¸åŸºçº¿SEMMAå¯¹æ¯”ï¼Œç¡®è®¤æœ‰æå‡
4. **è°ƒå‚ä¼˜åŒ–**: å¦‚æœæ•ˆæœå¥½ï¼Œå¯ä»¥å°è¯•è°ƒæ•´åˆå§‹å‚æ•°


