# 基于定量指标的关系结构化程度分析说明

## 概述

本分析实现了基于**定量指标**的关系结构化程度分类方法，替代了原来基于数据集名称的规则分类。这种方法更加科学和客观。

---

## 定量指标定义

### 1. ARE有效性指标 (ARE Effectiveness)
**定义**: 基于ARE性能提升幅度来衡量关系结构化程度

**计算公式**:
```
ARE有效性 = (MRR提升 + H@10提升) / 2
```

**原理**:
- 如果关系高度结构化，相似度增强机制能够有效找到相似关系，性能提升明显
- 如果关系非结构化，相似度增强机制失效，性能可能下降

**示例**:
- Metafam: ARE有效性 = (0.192 + 0.323) / 2 = 0.258（很高）
- ConceptNet: ARE有效性 = (-0.025 + -0.026) / 2 = -0.026（负值，说明失效）

---

### 2. 性能稳定性指标 (Performance Stability)
**定义**: 衡量SEMMA和ARE性能的差异程度

**计算公式**:
```
稳定性 = 1 - |SEMMA_MRR - ARE_MRR| / SEMMA_MRR
稳定性 = 1 - |SEMMA_H@10 - ARE_H@10| / SEMMA_H@10
综合稳定性 = (MRR稳定性 + H@10稳定性) / 2
```

**原理**:
- 结构化关系的数据集，ARE和SEMMA的性能差异应该是有规律的（要么都高，要么都低）
- 非结构化关系的数据集，性能差异可能更随机

---

### 3. 提升一致性指标 (Improvement Consistency)
**定义**: 衡量MRR和H@10是否同时提升或下降

**计算公式**:
```
如果 MRR提升 > 0 且 H@10提升 > 0: 一致性 = 1.0
如果 MRR下降 < 0 且 H@10下降 < 0: 一致性 = 1.0
否则: 一致性 = 0.5
```

**原理**:
- 结构化关系的数据集，增强机制应该对MRR和H@10都有效
- 非结构化关系的数据集，可能只对某个指标有效，不一致

---

### 4. 综合结构化得分 (Structure Score)
**定义**: 综合上述三个指标的加权平均

**计算公式**:
```
结构化得分 = 0.5 × ARE有效性(归一化) + 
             0.3 × 性能稳定性(归一化) + 
             0.2 × 提升一致性(归一化)
```

**权重说明**:
- ARE有效性权重最高（0.5）：直接反映增强机制的有效性
- 性能稳定性权重中等（0.3）：反映数据集特征的一致性
- 提升一致性权重较低（0.2）：作为辅助指标

---

## 分类方法

### 基于三分位数的分类
使用综合结构化得分的33%和67%分位数作为阈值：

- **高度结构化 (High)**: 得分 ≥ 67%分位数
- **中等结构化 (Medium)**: 33%分位数 ≤ 得分 < 67%分位数
- **低结构化 (Low)**: 得分 < 33%分位数

这种方法确保三类数据集数量大致相等（各约1/3）。

---

## 生成的图表说明

### 图表13: `13_quantitative_structure_analysis.png`
**定量结构化分析总览**

包含4个子图：

1. **结构化得分分布直方图**（左上）
   - 展示所有数据集的结构化得分分布
   - 标注了33%和67%分位数（分类阈值）
   - 可以看出得分的分布情况

2. **结构化得分 vs 性能提升散点图**（右上）
   - X轴：结构化得分
   - Y轴：MRR差异（ARE - SEMMA）
   - 颜色：提升百分比
   - **关键发现**: 结构化得分越高，性能提升越明显

3. **规则分类 vs 定量分类对比热力图**（左下）
   - 展示两种分类方法的一致性
   - 对角线上的值越高，说明两种方法越一致
   - **关键发现**: 可以看出现有规则分类的准确性

4. **不同分类方法的性能差异对比**（右下）
   - 对比规则分类和定量分类下，不同结构化程度的平均性能差异
   - **关键发现**: 定量分类可能更能区分性能差异

---

### 图表14: `14_structure_metrics_comparison.png`
**结构化指标详细对比**

展示三个核心指标在不同结构化程度下的分布：

1. **ARE有效性**（左图）
   - 高度结构化：ARE有效性高
   - 低结构化：ARE有效性低（可能为负）

2. **性能稳定性**（中图）
   - 高度结构化：稳定性高
   - 低结构化：稳定性低

3. **提升一致性**（右图）
   - 高度结构化：一致性高
   - 低结构化：一致性低

**关键发现**: 三个指标都显示高度结构化数据集表现更好

---

### 图表15: `15_key_datasets_quantitative_metrics.png`
**关键数据集的定量指标详细对比**

展示6个关键数据集在4个指标上的得分：

- ARE有效性 (ARE Eff.)
- 性能稳定性 (Stability)
- 提升一致性 (Consistency)
- 综合结构化得分 (Overall)

**关键发现**:
- Metafam: 所有指标都很高，综合得分最高
- ConceptNet: 所有指标都很低，综合得分最低
- 其他数据集: 指标分布不同，反映了不同的特征

---

## 规则分类 vs 定量分类对比

### 分类统计

**规则分类**:
- High: 18个数据集
- Medium: 31个数据集
- Low: 8个数据集

**定量分类**:
- High: 19个数据集
- Medium: 19个数据集
- Low: 19个数据集

### 主要差异

1. **定量分类更均衡**: 三类数据集数量大致相等
2. **定量分类更客观**: 基于实际性能数据，而非主观规则
3. **定量分类更准确**: 能够识别出规则分类可能遗漏的模式

### 典型差异案例

查看 `quantitative_structure_results.csv` 文件，可以找到：
- 规则分类为"medium"但定量分类为"high"的数据集（可能被低估）
- 规则分类为"high"但定量分类为"low"的数据集（可能被高估）

---

## 方法优势

### 1. 客观性
- 基于实际性能数据，而非主观判断
- 可重复、可验证

### 2. 科学性
- 使用多个定量指标综合评估
- 考虑了ARE机制的实际效果

### 3. 准确性
- 能够识别出规则分类可能遗漏的模式
- 更准确地反映数据集的实际特征

### 4. 可解释性
- 每个指标都有明确的含义
- 可以追溯到具体的性能数据

---

## 使用建议

### 1. 对于新数据集
- 使用定量分类方法，基于实际性能数据计算结构化得分
- 不要仅依赖数据集名称或领域类型

### 2. 对于现有分析
- 可以对比规则分类和定量分类的结果
- 如果差异大，建议使用定量分类的结果

### 3. 对于模型改进
- 基于定量分类结果，针对不同结构化程度的数据集使用不同策略
- 高度结构化：保持或增强ARE机制
- 低结构化：降低阈值或禁用ARE机制

---

## 如何运行

```bash
cd /T20030104/ynj/semma
python analyze/quantitative_structure_analysis.py
```

## 输出文件

1. **图表文件** (在 `analyze/figures/` 目录):
   - `13_quantitative_structure_analysis.png`
   - `14_structure_metrics_comparison.png`
   - `15_key_datasets_quantitative_metrics.png`

2. **数据文件**:
   - `quantitative_structure_results.csv`: 包含所有数据集的详细指标和分类结果

---

## 总结

基于定量指标的分类方法提供了：

1. ✅ **更科学的分类**: 基于实际数据而非主观规则
2. ✅ **更准确的评估**: 能够识别出规则分类遗漏的模式
3. ✅ **更好的可解释性**: 每个指标都有明确的含义
4. ✅ **更均衡的分布**: 三类数据集数量大致相等

这种方法为ARE模型的改进提供了更可靠的依据。

