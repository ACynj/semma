# ARE性能变化根本原因分析图表说明

本目录包含用于深入分析ARE性能显著上升或下降根本原因的可视化图表。

## 新增的根本原因分析图表

### 7. `7_relation_structure_impact.png`
**关系结构化程度对性能变化的影响**

- **左图**: 不同关系结构化程度的平均MRR差异
- **右图**: 不同关系结构化程度的平均H@10差异
- **分类**:
  - **High (Structured)**: 高度结构化关系（如Metafam生物关系、YAGO310结构化关系）
  - **Medium**: 中等结构化关系
  - **Low (Unstructured)**: 低结构化关系（如ConceptNet常识关系）

**关键发现**:
- ✅ **高度结构化关系**: ARE表现最好，平均MRR提升最大
- ⚠️ **低结构化关系**: ARE表现较差，平均MRR下降
- **结论**: 关系结构化程度是影响ARE性能的关键因素

**根本原因**: 
- 结构化关系在嵌入空间中聚类良好，相似度增强机制能够准确找到相似关系
- 非结构化关系在嵌入空间中分布较散，相似度阈值0.85过高，导致匹配失败

---

### 8. `8_domain_type_impact.png`
**领域类型对性能变化的影响**

- **左图**: 不同领域类型的平均MRR差异
- **右图**: 不同领域类型的平均H@10差异
- **分类**:
  - **Biology (Metafam)**: 生物信息学领域
  - **General (FB15K, YAGO)**: 通用知识图谱
  - **Domain-Specific (WikiTopics)**: 领域特定知识图谱
  - **Common Sense (ConceptNet)**: 常识知识图谱

**关键发现**:
- ✅ **生物领域**: ARE表现最好（Metafam提升74.4%）
- ✅ **通用领域**: ARE表现良好（FB15K、YAGO提升）
- ⚠️ **领域特定**: ARE表现较差（WikiTopics下降）
- ❌ **常识领域**: ARE表现最差（ConceptNet下降15.4%）

**根本原因**:
- 生物领域的关系（如"编码"、"转录"、"调节"）在语义空间中高度相关，相似度增强有效
- 常识关系（如"用于"、"位于"、"相关"）语义跨度大，相似度计算不准确
- 领域特定关系与预训练数据（FB15K237、WN18RR）分布不匹配

---

### 9. `9_pretrain_match_impact.png`
**预训练数据匹配度对性能变化的影响**

- **左图**: 不同预训练匹配度的平均MRR差异
- **右图**: 不同预训练匹配度的平均H@10差异
- **分类**:
  - **High Match (FB15K, WN18RR)**: 与预训练数据高度匹配
  - **Medium Match**: 中等匹配
  - **Low Match (ConceptNet, WikiTopics)**: 与预训练数据低匹配

**关键发现**:
- ✅ **高匹配**: ARE表现最好（与预训练数据相似）
- ⚠️ **低匹配**: ARE表现较差（与预训练数据差异大）

**根本原因**:
- ARE的相似度增强机制在预训练数据（FB15K237、WN18RR、CoDExMedium）上学习到的模式
- 当测试数据与预训练数据分布差异大时，增强机制失效
- ConceptNet和WikiTopics的关系分布与预训练数据不匹配

---

### 10. `10_key_datasets_features_radar.png`
**关键数据集特征对比雷达图**

- **图表类型**: 雷达图（Radar Chart）
- **特征维度**:
  - Relation Structure（关系结构化程度）
  - Domain Match（领域匹配度）
  - Data Scale（数据规模）
  - Relation Similarity（关系相似性）
  - Pretrain Match（预训练匹配度）
- **关键数据集**:
  - Metafam（绿色，提升）
  - YAGO310-ht（绿色，提升）
  - ConceptNet 100k-ht（红色，下降）
  - WikiTopicsMT3:infra（红色，下降）
  - FB15K237Inductive:v2（绿色，提升）
  - NELLInductive:v1（红色，下降）

**关键发现**:
- ✅ **提升的数据集**: 在关系结构化、领域匹配、关系相似性等维度得分高
- ❌ **下降的数据集**: 在预训练匹配、关系结构化等维度得分低
- **Metafam**: 在所有特征维度得分都很高，因此提升最大
- **ConceptNet**: 在预训练匹配和关系结构化得分低，因此下降

**根本原因**:
- 多维度特征综合决定了ARE的性能
- 提升的数据集在多个维度都表现良好
- 下降的数据集在关键维度（如预训练匹配）表现差

---

### 11. `11_performance_vs_base.png`
**性能变化 vs 基础性能**

- **左图**: MRR变化 vs SEMMA基础MRR
- **右图**: H@10变化 vs SEMMA基础H@10
- **颜色**: 表示提升百分比（绿色=提升，红色=下降）
- **标注**: 关键数据集名称

**关键发现**:
- ✅ **低基础性能数据集**: ARE提升更明显（如Metafam从0.258提升到0.450）
- ⚠️ **高基础性能数据集**: ARE可能下降（如NELLInductive:v1从0.796下降到0.780）
- **ConceptNet**: 虽然基础性能低（0.162），但ARE仍然下降

**根本原因**:
- ARE在需要提升的数据集上表现更好
- 在已经表现很好的数据集上，额外增强可能引入干扰
- ConceptNet虽然基础性能低，但由于关系非结构化，ARE仍然失效

---

### 12. `12_feature_importance_heatmap.png`
**特征重要性热力图**

- **图表类型**: 热力图（Heatmap）
- **行**: 不同特征类型（Relation Structure, Pretrain Match, Relation Similarity）
- **列**: 特征值（High, Medium, Low）
- **颜色**: 表示平均MRR差异（绿色=提升，红色=下降）

**关键发现**:
- **Relation Structure**: 影响最大，High值显著提升，Low值显著下降
- **Pretrain Match**: 影响次之，High值提升，Low值下降
- **Relation Similarity**: 影响中等，High值提升，Low值下降

**根本原因**:
- 关系结构化程度是最重要的因素
- 预训练数据匹配度是第二重要因素
- 关系相似性也有重要影响

---

## 综合结论

### 1. 关系结构化程度是决定性因素
- **证据**: 图表7显示高度结构化关系平均MRR提升最大
- **原因**: 结构化关系在嵌入空间中聚类良好，相似度增强有效

### 2. 领域类型显著影响性能
- **证据**: 图表8显示生物领域表现最好，常识领域表现最差
- **原因**: 不同领域的关系语义分布不同

### 3. 预训练数据匹配度很重要
- **证据**: 图表9显示高匹配度数据集表现更好
- **原因**: ARE的增强机制在预训练数据上学习，需要测试数据分布相似

### 4. 多维度特征综合决定性能
- **证据**: 图表10雷达图显示提升的数据集在多个维度得分高
- **原因**: 单一特征不足，需要综合考虑

### 5. 基础性能不是唯一因素
- **证据**: 图表11显示低基础性能不一定提升，高基础性能可能下降
- **原因**: 数据集特征（如关系结构化）比基础性能更重要

### 6. 特征重要性排序
- **证据**: 图表12热力图显示特征影响大小
- **排序**: Relation Structure > Pretrain Match > Relation Similarity

---

## 实际应用建议

### 对于不同数据集类型的策略：

1. **高度结构化关系数据集**（如Metafam、YAGO310）
   - ✅ 使用ARE，预期显著提升
   - ✅ 可以保持或提高增强强度

2. **常识关系数据集**（如ConceptNet）
   - ❌ 降低相似度阈值（从0.85降至0.6-0.7）
   - ❌ 或禁用增强机制

3. **领域特定数据集**（如WikiTopics）
   - ⚠️ 考虑使用领域特定的相似度计算
   - ⚠️ 或为不同主题使用不同的增强策略

4. **已表现很好的数据集**（如NELLInductive:v1）
   - ⚠️ 减弱或禁用增强机制
   - ⚠️ 避免引入不必要的干扰

5. **与预训练数据不匹配的数据集**
   - ⚠️ 考虑使用领域适应技术
   - ⚠️ 或调整预训练策略

---

## 如何运行脚本

```bash
cd /T20030104/ynj/semma
python analyze/analyze_root_causes.py
```

## 依赖包

- matplotlib
- pandas
- numpy
- seaborn

---

## 总结

这些根本原因分析图表从多个维度深入分析了ARE性能变化的原因：

1. ✅ **关系结构化程度**是最重要的因素
2. ✅ **领域类型**显著影响性能
3. ✅ **预训练数据匹配度**很重要
4. ✅ **多维度特征**综合决定性能
5. ✅ **特征重要性**有明确排序

这些发现为ARE模型的改进提供了明确的方向和策略。

